//
//  ContactsWorker.swift
//  santanderTest
//
//  Created by Adauto Oliveira on 26/05/19.
//  Copyright (c) 2019 Adauto Oliveira. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

class ContactsWorker
{
 
  func doSomeWork(){
    let basePath = "https://floating-mountain-50292.herokuapp.com/fund.json"
    let configuration: URLSessionConfiguration = {
        let config = URLSessionConfiguration.default
        config.allowsCellularAccess = true
        config.httpAdditionalHeaders = ["Content-Type": "application/json"]
        config.timeoutIntervalForRequest = 30.0
        config.httpMaximumConnectionsPerHost = 5
        return config
    }()
    
    let session = URLSession(configuration: configuration)
    
    typealias RestLoadCompletion = (Form) -> Void
    
    func loadForm(completion : @escaping (Form?) -> Void)  {
        guard let url = URL(string: basePath) else {return}
        
        let dataTask = session.dataTask(with: url) { (data: Data?, response: URLResponse?, error: Error?) in
            if error == nil {
                guard let response = response as? HTTPURLResponse else {return}
                if response.statusCode == 200 {
                    guard let data = data else {return}
                    
                    do{
                        let cells = try JSONDecoder().decode([Contacts.Something.ViewModel.DisplayedForm].self, from: data)
                        for form in cells {
                            print(form.message)
                        }
                    }catch{
                        print(error.localizedDescription)
                    }
                }else {
                    print(error?.localizedDescription as Any)
                }
                
            }else {
                print(error?.localizedDescription as Any)
            }
        }
        dataTask.resume()
        
    }
  }
    
}


